# その他の設定ファイルを編集する

## macro.txtの設定(application 0.10.2以降)

- マクロの内容を編集できます。マクロ機能の詳細についてはQMKのドキュメントを参照してください。
- VIAのMacroタブを使って設定することもできます。設定方法についてはVIAのドキュメントを参照してください。
- 1行目は必ず`macro`にする必要があります。
- 2行目から順に1行ずつ`MACRO00`, `MACRO01`, ... `MACRO15`を押したときのマクロになります。マクロに改行(ENTER)を含めたい場合は`\n`を使ってください。
- 0~15まで合計で1024バイト分のマクロを保存できます。
- アスキー文字で割り当てられないマクロは下記エスケープシーケンスで表現します。

  | エスケープシーケンス | 役割          |
  | -------------------- | ------------- |
  | `\n`                 | KC_ENT        |
  | `\t`                 | KC_TAB        |
  | `\b`                 | KC_BSPACE     |
  | `\\`                 | KC_BSLASH     |
  | `\d`                 | KC_DEL        |
  | `\e`                 | KC_ESC        |
  | `\T(KC_YY)`          | SS_TAP(X_YY)  |
  | `\D(KC_YY)`          | SS_DOWN(X_YY) |
  | `\U(KC_YY)`          | SS_UP(X_YY)   |

- `\T`, `\D`, `\U`に続くキーコードの表記法はkeymap.jsonと同様です。
- SS_DELAYに当たる機能は実装されていません。

### 設定例

```txt
macro
Macro\nTest
\D(KC_LGUI)\T(KC_L)\U(KC_LGUI)
```

- 上記内容でmacro.txtを保存後、キーマップに下記のいずれかの方法でMACROxxを割り当てることでマクロが呼び出せるようになります。
  - keymap.jsonを直接編集する
  - QMK Configuratorで`ANY(MACROxx)`を指定する
  - VIAでMxxを設定する
  - Remapで0x5f12~を設定する
- MACRO00: 下記文字列を入力

  ```
  Macro
  Test
  ```

- MACRO01: (Windowsの場合)画面ロック
  - `\T`を使わずに`\D(KC_LGUI)l\U(KC_LGUI)`としても同じ動作です。

## tapping_term.jsonの設定

- get_tapping_term()で返すキーコードとタッピングタームのペアを設定します。
- KC_NOに設定したタッピングタームがデフォルト値になります。
- KC_NOは一番最後に設定してください。

  ```
  {"tapping_term":{
        "LT(1,KC_A)":300,  
        "KC_NO":200,
        }}
  ```

## encoder.jsonの設定

- 最大4つのエンコーダを接続できます。（分割型の場合Master側のみ）

- enabledを1にすることでエンコーダ機能が有効になります。なお、この機能を使用する場合は電流消費量が平均で100uAくらい増加します。

| メンバ | 役割                                                                                                                                                                               |
| ------ | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| pin    | エンコーダのA相、B相を接続したピンを指定します                                                                                                                                     |
| step   | エンコーダが何ステップ移動したらアクションを実行するか指定します                                                                                                                   |
| action | レイヤごとにCW,CCW回転したときのアクションをキーコードで指定します。5レイヤまでアクションを指定できます。6レイヤ以上に移動した場合にはデフォルトレイヤのアクションが実行されます。アプリケーションv0.11.2からは設定の仕方によってキーマップ上のキーコードを参照するように指定できます(後述)。これにより、VIA/Remapからアクションを設定できるようになります。 |

アクションは基本的には指定したキーコードをタップするのと同等の動作ですが、モディファイアのみ若干異なる動作をします。

モディファイア付きのアクションを実行した場合、

- 約500ms間エンコーダの操作をしない
- 他のエンコーダのアクションを実行する
- キー入力が発生する

のいずれかまで、モディファイアが保持されます。

これにより、例えば`Alt+Tab`でウィンドウを切り替えるときにウィンドウ一覧がしばらく表示できるなど、モディファイアを押した状態で他のキーを連打するような動作が便利になります。

もしこの機能を無効にしたい場合、[ファームウェアを自分でビルド](build_firmware.md)して `bmp_encoder_reaed`関数を上書きしてください。

### (アプリケーションv0.11.2以降)アクションを直接指定する代わりにキーマップ上のキーコードを参照する

- 各エンコーダ設定の"action"の1つ目を["KC_TRNS", "KC_NO"]に設定する
- 各エンコーダ設定の"action"の2つ目を参照したいキーマップの連番（CONFIG.JSNのlayoutで指定している番号）に設定する。たとえばCW方向では13, CCWでは14を参照したいときは["ANY(13)", "ANY(14)"]とする
- 該当するキーマップへ回転時に実行したいキーコードを設定する

例：owl8の場合は下記のように設定すると、キーマップの最上段をREMAPから書き換えることでエンコーダの動作を設定できます

- config.json
 
```json
{"config":{"version":2,
"device_info":{"vid":"0x5946","pid":"0x0008","name":"owl8","manufacture":"yfuku","description":""},
"matrix":{"rows":1,"cols":16,"device_rows":1,"device_cols":16,"debounce":1,"is_left_hand":1,"diode_direction":0,"row_pins":[],"col_pins":[20,17,15,13,19,18,16,14,7,8,9,10],
"layout":[
 13, 14, 15, 16,  0,
  9, 10, 11, 12,  0,
  1,  2,  3,  4,  0,
  5,  6,  7,  8]},
"mode":"SINGLE","startup":1,
"peripheral":{"max_interval":30,"min_interval":30,"slave_latency":16},
"central":{"max_interval":30,"min_interval":30,"slave_latency":0},
"led":{"pin":255,"num":0},
"keymap":{"locale":"US","use_ascii":0},
"reserved":[0,0,0,0,0,0,0,0]}}
```

- encoder.json

```json
{"encoder":
{"enabled":1,
"definition":[
{"pin":[7,8],"step":4,"action":[["ANY(1)","ANY(0)"], ["ANY(13)","ANY(14)"], ["ANY(0)","ANY(0)"], ["ANY(0)","ANY(0)"], ["ANY(0)","ANY(0)"]]},
{"pin":[9,10],"step":4,"action":[["ANY(1)","ANY(0)"], ["ANY(15)","ANY(16)"], ["ANY(0)","ANY(0)"], ["ANY(0)","ANY(0)"], ["ANY(0)","ANY(0)"]]}
]}}
```